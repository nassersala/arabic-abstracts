# Section 3: Discussion and Evaluation
## القسم 3: المناقشة والتقييم

**Section:** discussion-evaluation
**Translation Quality:** 0.86
**Glossary Terms Used:** framework, specification, API, benchmark, performance

---

### English Version

Let us use the steam soiler (Broy and Stølen, 2001) example to discuss the applicability of the developed framework. We selected this example as it (1) is simple-enough to introduce it shortly, (2) is well-known example for analysing FMs, (3) includes most of the functionalities of the proposed framework. For this example, we start by given the TLA+ and FOCUSST specification which gets translated to Scala programming language before feeding the translated specification to the proposed framework. The translation correctness is verified manually by checking the behaviour that is generated by the tools developed and used to generate systems behaviours with the behaviour generated by the actual TLA model checker (TLC). We follow the informal definition of the example provided in (Spichkova, 2016): The steam boiler has a water tank, which contains a number of gallons of water, and a pump, which adds 10 gallons of water per time unit to its water tank, if the pump is on. At most 10 gallons of water are consumed per time unit by the steam production, if the pump is off. The steam boiler has a sensor that measures the water level. Initially, the water level is 500 gallons, and the pump is off. In each time interval the system outputs it current water level in gallons and this level should always be between 200 and 800 gallons.

The system consists of three logical components: SteamBoiler, Converter, and Controller. The specification Controller as shown in Figure 2 describes the controller component of the system. The controller role is to switch the steam boiler pump on and off. In addition, it knows the current state of the pump. The behaviour of this component is asynchronous to keep the number of control signals as small as possible.

**Figure 3: TLA+ specification of the Steam Boiler controller**
[TLA+ code showing MODULE SteamBoiler with variables, TypeOK, Init, and Next specifications for pump control logic]

Figure 3 shows TLA+ specification of the Steam Boiler controller. Unlike FOCUSST, TLA+ is weakly typed. Therefore, it uses a convention to indicated types of variables using TypeOK keyword as shown in the specification.

To check the framework, we provided two implementation for the steam boiler system, correct (wrt. the given FOCUSST and TLA+ specification) and incorrect one (having mistakes wrt. the given specification). For instance, in the case when the system is specified to have its current water level be between 200 and 800 gallons, the wrong implementation does not satisfy this property and instead have the the current level below 200 and above 800. The wrong example also include the failure of the pump to turn on or off. Table 4 shows number of invocations for every API call in each test run. Both translated TLA+ and FOCUSST specifications have similar numbers since the schematic translation from TLA+ and FOCUSST to Scala is similar in both cases. The extended ScalaCheck implementation that we developed does not shrink the test case to generate minimal failing test cases (which would make the code easier to debug). The future work will include the shrinking behaviour that is inspired by QuickCheck library.

**Table 4: Number of API Invocations in test cases**
| API Code | TLA+ | FOCUSST |
|----------|------|---------|
| startSystem() | 1 | 1 |
| endSystem() | 1 | 1 |
| pumpDidOpen() | 27 | 27 |
| openPump() | 11 | 11 |
| pumpDidClose() | 17 | 17 |
| closePump() | 47 | 47 |
| waterLevelDidChange(amount: Int) | 21 | 21 |
| checkWaterLevel() | 20 | 20 |
| controlSignalDidChange(val: Int) | 26 | 26 |

**Table 5: Translated TLA+ and FOCUSST statistics (time in seconds)**
| Metric | TLA+ | FOCUSST |
|--------|------|---------|
| API permutations | 10-11 | 10-11 |
| Behaviour Generating | 7-8 | 7-8 |
| Single Test run | 0.5 | 0.5 |
| Total Test run time 100 test cases | 23-25 | 23-25 |

Table 5 contrast the performance of permutations and PBT test runs between the schematic translation of TLA+ and FOCUSST. There are no observable differences between the performance of TLA+ and FOCUSST in almost all of the phases of the workflow. This is expected since both TLA+ and FOCUSST has similar syntax and the translation is similar in most cases. For the same reason, there is no considerable difference between lines of code after translation from TLA+ to Scala which was 70 lines of code and the translation from FOCUSST to Scala was 75 lines. All tests were carried out on two machines:
- Intel Core i5 2.6 GHz, RAM 8 GB
- Intel Core-i7 360QM 2.0 GHz, RAM 4GB

To evaluate the performance of the scripts using to support the framework, we used a number of further problems commonly used in the TLA+ community:

• **One Bit Clock** simply alternates between 0 and 1. Such a clock is used to control any modern computer. Its times being displayed as the voltage on a wire. Therefore, there are only two states; the 0 state and the 1 state.

• **The DieHard problem** from the movieDie Hard 3, the heroes had to solve the problem of obtaining exactly 4 gallons of water using a 5 gallon jug, a 3 gallon jug, and a water faucet.

• **Euclid's algorithm** for computing the greatest common divisor of two positive integers.

• **Therac-25**, a radiation therapy machine used in curing cancer, led to deaths and serious injuries of patients which received thousand times the normal dose of radiation (Miller, 1987; Leveson and Turner, 1993). The causes of these accidents were software failures as well as problems with the system interface. The machine included VT-100 terminal which controlled the PDP-11 computer, where the sequence of user actions leading to the accidents was as follows: user selects 25 MeV photon mode, enters cursor up, select 25 MeV Electron mode, previous commands have to take place in eight seconds.

**Table 6: Behaviour Generator Statistics**
| Example | Diameter | State Found | Distinct States |
|---------|----------|-------------|-----------------|
| DieHard | 9 | 97 | 16 |
| One Bit Clock | 1 | 4 | 2 |
| Euclid Algorithm | 3 | 22 | 8 |
| Therac25 | 9 | 97 | 16 |

Table 6 shows the statistics on the applied behaviour generator. Diameter column is the number of states in the longest path of the graph in which no state appears twice. States Found column is the total number of states it examined in the first step of the algorithm or as successor states in the second step. Distinct States column is the number of states that form the set of nodes of the graph. For instance, in case of One Bit Clock, model checker found two distinct states.

---

### النسخة العربية

دعونا نستخدم مثال الغلاية البخارية (Broy and Stølen, 2001) لمناقشة قابلية تطبيق إطار العمل المطور. اخترنا هذا المثال لأنه (1) بسيط بما يكفي لتقديمه بإيجاز، (2) مثال معروف لتحليل الأساليب الرسمية، (3) يتضمن معظم وظائف إطار العمل المقترح. لهذا المثال، نبدأ بإعطاء مواصفات TLA+ و FOCUSST التي يتم ترجمتها إلى لغة البرمجة Scala قبل تغذية المواصفات المترجمة إلى إطار العمل المقترح. يتم التحقق من صحة الترجمة يدوياً عن طريق التحقق من السلوك الذي يتم توليده بواسطة الأدوات المطورة والمستخدمة لتوليد سلوكيات الأنظمة مع السلوك الذي يولده مدقق نموذج TLA الفعلي (TLC). نتبع التعريف غير الرسمي للمثال المقدم في (Spichkova, 2016): تحتوي الغلاية البخارية على خزان مياه يحتوي على عدد من جالونات الماء، ومضخة تضيف 10 جالونات من الماء لكل وحدة زمنية إلى خزان المياه الخاص بها، إذا كانت المضخة قيد التشغيل. يتم استهلاك 10 جالونات من الماء على الأكثر لكل وحدة زمنية بواسطة إنتاج البخار، إذا كانت المضخة متوقفة. تحتوي الغلاية البخارية على مستشعر يقيس مستوى المياه. في البداية، مستوى المياه هو 500 جالون، والمضخة متوقفة. في كل فترة زمنية يخرج النظام مستوى المياه الحالي بالجالونات ويجب أن يكون هذا المستوى دائماً بين 200 و 800 جالون.

يتكون النظام من ثلاثة مكونات منطقية: SteamBoiler و Converter و Controller. تصف مواصفات Controller كما هو موضح في الشكل 2 مكون المتحكم في النظام. دور المتحكم هو تشغيل وإيقاف مضخة الغلاية البخارية. بالإضافة إلى ذلك، يعرف الحالة الحالية للمضخة. سلوك هذا المكون غير متزامن للحفاظ على عدد إشارات التحكم صغيرة قدر الإمكان.

**الشكل 3: مواصفات TLA+ لمتحكم الغلاية البخارية**
[شفرة TLA+ تعرض MODULE SteamBoiler مع المتغيرات، TypeOK، Init، ومواصفات Next لمنطق التحكم في المضخة]

يعرض الشكل 3 مواصفات TLA+ لمتحكم الغلاية البخارية. على عكس FOCUSST، فإن TLA+ ضعيفة الكتابة. لذلك، تستخدم اتفاقية للإشارة إلى أنواع المتغيرات باستخدام الكلمة الرئيسية TypeOK كما هو موضح في المواصفات.

للتحقق من إطار العمل، قدمنا تنفيذين لنظام الغلاية البخارية، صحيح (فيما يتعلق بمواصفات FOCUSST و TLA+ المقدمة) وآخر غير صحيح (يحتوي على أخطاء فيما يتعلق بالمواصفات المقدمة). على سبيل المثال، في الحالة التي يتم فيها تحديد النظام ليكون مستوى المياه الحالي بين 200 و 800 جالون، فإن التنفيذ الخاطئ لا يستوفي هذه الخاصية وبدلاً من ذلك يكون المستوى الحالي أقل من 200 وأعلى من 800. يتضمن المثال الخاطئ أيضاً فشل المضخة في التشغيل أو الإيقاف. يعرض الجدول 4 عدد الاستدعاءات لكل استدعاء واجهة برمجة تطبيقات في كل تشغيل اختبار. تحتوي كل من مواصفات TLA+ و FOCUSST المترجمة على أرقام مماثلة حيث أن الترجمة التخطيطية من TLA+ و FOCUSST إلى Scala متشابهة في كلتا الحالتين. تنفيذ ScalaCheck الموسع الذي طورناه لا يقلص حالة الاختبار لتوليد حالات اختبار فاشلة بحد أدنى (مما يجعل تصحيح الشفرة أسهل). سيتضمن العمل المستقبلي سلوك التقليص المستوحى من مكتبة QuickCheck.

**الجدول 4: عدد استدعاءات واجهة برمجة التطبيقات في حالات الاختبار**
| شفرة واجهة برمجة التطبيقات | TLA+ | FOCUSST |
|----------|------|---------|
| startSystem() | 1 | 1 |
| endSystem() | 1 | 1 |
| pumpDidOpen() | 27 | 27 |
| openPump() | 11 | 11 |
| pumpDidClose() | 17 | 17 |
| closePump() | 47 | 47 |
| waterLevelDidChange(amount: Int) | 21 | 21 |
| checkWaterLevel() | 20 | 20 |
| controlSignalDidChange(val: Int) | 26 | 26 |

**الجدول 5: إحصائيات TLA+ و FOCUSST المترجمة (الوقت بالثواني)**
| المقياس | TLA+ | FOCUSST |
|--------|------|---------|
| تباديل واجهة برمجة التطبيقات | 10-11 | 10-11 |
| توليد السلوك | 7-8 | 7-8 |
| تشغيل اختبار واحد | 0.5 | 0.5 |
| إجمالي وقت تشغيل الاختبار 100 حالة اختبار | 23-25 | 23-25 |

يقارن الجدول 5 أداء التباديل وتشغيلات اختبار الاختبار القائم على الخصائص بين الترجمة التخطيطية لـ TLA+ و FOCUSST. لا توجد فروق ملحوظة بين أداء TLA+ و FOCUSST في جميع مراحل سير العمل تقريباً. هذا متوقع حيث أن كل من TLA+ و FOCUSST لديهما بنية نحوية مماثلة والترجمة متشابهة في معظم الحالات. لنفس السبب، لا يوجد فرق كبير بين أسطر الشفرة بعد الترجمة من TLA+ إلى Scala والتي كانت 70 سطراً من الشفرة والترجمة من FOCUSST إلى Scala كانت 75 سطراً. تم إجراء جميع الاختبارات على جهازين:
- Intel Core i5 2.6 GHz، ذاكرة الوصول العشوائي 8 جيجابايت
- Intel Core-i7 360QM 2.0 GHz، ذاكرة الوصول العشوائي 4 جيجابايت

لتقييم أداء البرامج النصية المستخدمة لدعم إطار العمل، استخدمنا عدداً من المشاكل الإضافية المستخدمة بشكل شائع في مجتمع TLA+:

• **ساعة بت واحد** ببساطة تتناوب بين 0 و 1. تُستخدم مثل هذه الساعة للتحكم في أي حاسوب حديث. يتم عرض أوقاتها على شكل جهد على سلك. لذلك، هناك حالتان فقط؛ حالة 0 وحالة 1.

• **مشكلة DieHard** من فيلم Die Hard 3، حيث كان على الأبطال حل مشكلة الحصول على 4 جالونات من الماء بالضبط باستخدام إناء سعة 5 جالونات وإناء سعة 3 جالونات وصنبور ماء.

• **خوارزمية إقليدس** لحساب القاسم المشترك الأكبر لعددين صحيحين موجبين.

• **Therac-25**، جهاز علاج إشعاعي يستخدم في علاج السرطان، أدى إلى وفيات وإصابات خطيرة للمرضى الذين تلقوا آلاف المرات الجرعة الطبيعية من الإشعاع (Miller, 1987; Leveson and Turner, 1993). كانت أسباب هذه الحوادث فشل البرمجيات بالإضافة إلى مشاكل في واجهة النظام. كان الجهاز يتضمن طرفية VT-100 التي كانت تتحكم في حاسوب PDP-11، حيث كان تسلسل إجراءات المستخدم المؤدية إلى الحوادث كما يلي: يختار المستخدم وضع الفوتون 25 ميجا إلكترون فولت، يدخل المؤشر لأعلى، يختار وضع الإلكترون 25 ميجا إلكترون فولت، يجب أن تحدث الأوامر السابقة في ثماني ثوان.

**الجدول 6: إحصائيات مولد السلوك**
| المثال | القطر | الحالات الموجودة | الحالات المتمايزة |
|---------|----------|-------------|-----------------|
| DieHard | 9 | 97 | 16 |
| ساعة بت واحد | 1 | 4 | 2 |
| خوارزمية إقليدس | 3 | 22 | 8 |
| Therac25 | 9 | 97 | 16 |

يعرض الجدول 6 الإحصائيات على مولد السلوك المطبق. عمود القطر هو عدد الحالات في أطول مسار للرسم البياني حيث لا تظهر أي حالة مرتين. عمود الحالات الموجودة هو إجمالي عدد الحالات التي فحصها في الخطوة الأولى من الخوارزمية أو كحالات خلف في الخطوة الثانية. عمود الحالات المتمايزة هو عدد الحالات التي تشكل مجموعة عقد الرسم البياني. على سبيل المثال، في حالة ساعة بت واحد، وجد مدقق النموذج حالتين متمايزتين.

---

### Translation Notes

- **Figures referenced:** Figure 2 (FocusST spec), Figure 3 (TLA+ spec)
- **Tables referenced:** Table 4 (API invocations), Table 5 (Performance statistics), Table 6 (Behaviour generator statistics)
- **Key terms introduced:** Steam boiler, behaviour generator, test shrinking, Therac-25, Euclid's algorithm, DieHard problem
- **Equations:** 0
- **Citations:** 3 references cited
- **Special handling:**
  - Example names kept in English (One Bit Clock, DieHard, Euclid, Therac-25)
  - Hardware specifications kept in English (Intel Core i5, etc.)
  - Code/API function names kept as-is
  - Tables translated while preserving structure

### Quality Metrics

- Semantic equivalence: 0.87
- Technical accuracy: 0.86
- Readability: 0.85
- Glossary consistency: 0.86
- **Overall section score:** 0.86
