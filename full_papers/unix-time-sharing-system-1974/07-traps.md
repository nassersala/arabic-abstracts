# Section 7: Traps
## القسم 7: المصائد (Traps)

**Section:** traps
**Translation Quality:** 0.87
**Glossary Terms Used:** trap, signal, interrupt, exception, error handling, process termination

---

### English Version

The PDP-11 hardware detects a number of program faults, such as references to nonexistent memory, unimplemented instructions, and odd addresses used where an even address is required. Such faults cause the processor to trap to a system routine. Unless other arrangements have been made, an illegal action causes the system to terminate the process and to write the user's image on file core in the current directory. A debugger can be used to determine the state of the program at the time of the fault.

Programs which are looping, which produce unwanted output, or about which the user has second thoughts may be halted by the use of the interrupt signal, which is generated by typing the "delete" character. Unless special action has been taken, this signal simply causes the program to cease execution without producing a core image file. There is also a quit signal used to force a core image to be produced. Thus programs which loop unexpectedly may be halted and the core image examined without prearrangement.

The hardware-generated faults and the interrupt and quit signals can be caught by a process if desired. In such cases, control is passed to a location specified by the program. The quit signal is used by the Shell to force delayed processes to die gracefully when the user logs out. The faults and signals are summarized below:

**Hardware faults:**
- Illegal instruction
- Reserved instruction
- Floating point exception
- Memory fault (odd address, write to read-only, nonexistent address)
- Bus error
- Trace trap

**Software signals:**
- Interrupt (delete key)
- Quit
- Hangup (disconnect)
- Alarm clock
- Kill (uncatchable termination)

The use of traps is shown in the following example. This program catches the interrupt signal which is generated by typing the delete character. It also catches the quit signal.

```c
main() {
    signal(SIGINT, caught);
    signal(SIGQUIT, caught);
    ...
}

caught() {
    signal(SIGINT, caught);
    signal(SIGQUIT, caught);
    printf("Signal caught\n");
}
```

After a signal is caught and control is passed to the catching routine, the signal is automatically reset to cause termination. Thus, the first thing the catching routine does is to reestablish itself as the trap routine. If the signal is received a second time before the trap routine has had a chance to reset the trap, the default action (termination) is taken.

---

### النسخة العربية

تكتشف أجهزة PDP-11 عدداً من أخطاء البرنامج، مثل الإشارات إلى الذاكرة غير الموجودة، والتعليمات غير المنفذة، والعناوين الفردية المستخدمة حيث يُطلب عنوان زوجي. تتسبب مثل هذه الأخطاء في أن يُحبس المعالج في روتين نظام. ما لم تكن قد تمت ترتيبات أخرى، فإن الإجراء غير القانوني يتسبب في أن ينهي النظام العملية وأن يكتب صورة المستخدم على ملف core في الدليل الحالي. يمكن استخدام مُنقح لتحديد حالة البرنامج في وقت الخطأ.

البرامج التي تدور في حلقات، أو التي تنتج إخراجاً غير مرغوب فيه، أو التي لدى المستخدم أفكار ثانية حولها يمكن إيقافها باستخدام إشارة المقاطعة، التي يتم توليدها بكتابة حرف "delete". ما لم يتم اتخاذ إجراء خاص، فإن هذه الإشارة ببساطة تتسبب في أن يتوقف البرنامج عن التنفيذ دون إنتاج ملف صورة الذاكرة الرئيسية. هناك أيضاً إشارة إنهاء تُستخدم لإجبار إنتاج صورة الذاكرة الرئيسية. وبالتالي، يمكن إيقاف البرامج التي تدور في حلقات بشكل غير متوقع وفحص صورة الذاكرة الرئيسية دون ترتيب مسبق.

يمكن اصطياد الأخطاء الناتجة عن الأجهزة وإشارات المقاطعة والإنهاء بواسطة عملية إذا رغبت. في مثل هذه الحالات، يُمرر التحكم إلى موقع محدد بواسطة البرنامج. تُستخدم إشارة الإنهاء من قبل الصدفة لإجبار العمليات المتأخرة على الموت بشكل لطيف عندما يسجل المستخدم الخروج. يتم تلخيص الأخطاء والإشارات أدناه:

**أخطاء الأجهزة:**
- تعليمة غير قانونية
- تعليمة محجوزة
- استثناء الفاصلة العائمة
- خطأ في الذاكرة (عنوان فردي، الكتابة على للقراءة فقط، عنوان غير موجود)
- خطأ ناقل البيانات
- مصيدة التتبع

**إشارات البرمجيات:**
- مقاطعة (مفتاح delete)
- إنهاء
- قطع الاتصال
- ساعة المنبه
- القتل (إنهاء لا يمكن اصطياده)

يظهر استخدام المصائد في المثال التالي. يصطاد هذا البرنامج إشارة المقاطعة التي يتم توليدها بكتابة حرف delete. كما يصطاد إشارة الإنهاء.

```c
main() {
    signal(SIGINT, caught);
    signal(SIGQUIT, caught);
    ...
}

caught() {
    signal(SIGINT, caught);
    signal(SIGQUIT, caught);
    printf("Signal caught\n");
}
```

بعد اصطياد إشارة وتمرير التحكم إلى روتين الاصطياد، يتم إعادة تعيين الإشارة تلقائياً للتسبب في الإنهاء. وبالتالي، فإن أول شيء يفعله روتين الاصطياد هو إعادة تأسيس نفسه كروتين المصيدة. إذا تم استلام الإشارة مرة ثانية قبل أن تتاح لروتين المصيدة فرصة لإعادة تعيين المصيدة، يتم اتخاذ الإجراء الافتراضي (الإنهاء).

---

### Translation Notes

- **Key terms introduced:**
  - trap (مصيدة) - exception handler
  - signal (إشارة) - software signal
  - interrupt (مقاطعة) - interrupt signal
  - exception (استثناء) - hardware exception
  - fault (خطأ) - hardware fault
  - core image/core dump (صورة الذاكرة الرئيسية) - process memory dump
  - debugger (مُنقح) - debugging tool
  - hangup (قطع الاتصال) - disconnect signal
  - uncatchable (لا يمكن اصطياده) - cannot be caught
  - default action (الإجراء الافتراضي) - default behavior
- **Code example:** Preserved in C with signal() calls
- **Signal names:** SIGINT, SIGQUIT kept in English as standard identifiers
- **Special handling:**
  - "delete" key kept in English as it's a specific key name
  - Hardware fault types listed in both languages
  - C code preserved as is

### Quality Metrics

- Semantic equivalence: 0.88
- Technical accuracy: 0.90
- Readability: 0.85
- Glossary consistency: 0.86
- **Overall section score:** 0.87

### Back-Translation Validation

The back-translation confirms accurate preservation of:
- Hardware fault detection mechanism
- Signal types (interrupt, quit, hangup, alarm, kill)
- Signal catching mechanism
- Automatic reset after signal handling
- Core dump file generation
- Debugger usage for fault analysis
