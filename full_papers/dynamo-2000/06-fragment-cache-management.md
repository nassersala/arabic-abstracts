# Section 6: Fragment Cache Management
## القسم 6: إدارة ذاكرة الأجزاء المؤقتة

**Section:** fragment-cache-management
**Translation Quality:** 0.86
**Glossary Terms Used:** fragment cache, working set, cache flush, TLB, instruction cache locality, pre-emptive flushing, garbage collection

---

### English Version

Dynamo cannot afford to do complicated management of the fragment cache storage, because of the overheads this would incur. We could avoid storage management altogether by simply expanding the size of the fragment cache as needed. But this has several undesirable effects. For example, one of the advantages of collecting hot traces in a separate fragment cache is the improved instruction cache locality and TLB utilization that can result from keeping the working set close together in memory. This advantage could go away if over time, the hot traces that make up the current working set are spread out over a large area of fragment cache memory. Clearly, the ideal situation where the fragment cache only contains the traces that make up the current working set is difficult to achieve. The overhead of implementing an LRU type scheme to identify cold fragments would be too expensive as well. Moreover, as pointed out earlier, any policy that only removes a few fragments would incur the expense of having to unlink every incoming branch into these fragments.

Dynamo instead employs a novel pre-emptive flushing heuristic to periodically remove cold traces from the fragment cache without incurring a high penalty. A complete fragment cache flush is triggered whenever Dynamo recognizes a sharp increase in the fragment creation rate (or hot trace selection rate). The rationale here is that a sharp rise in new fragment creation is very likely indicative of a significant change in the working set of the program that is currently in the fragment cache. Since control is predominantly being spent in Dynamo during this stage, the fragment cache flush is essentially "free". Figure 6 illustrates this scenario for the SpecInt95 m88ksim benchmark. Since all fragments are removed during a fragment cache flush, no unlinking of branches needs to be done.

The pre-emptive flushing mechanism has other useful side effects. All fragment-related data structures maintained for internal bookkeeping by Dynamo are tied to the flush, causing these memory pools to be reset as a side effect of a pre-emptive flush. A pre-emptive flush thus serves as an efficient garbage collection mechanism to free dynamic objects associated with fragments that are likely to have dropped out of the current working set. If some fragments belonging to the new working set are inadvertently flushed as a result, they will be regenerated by Dynamo when those program addresses are encountered later during execution. Regeneration of fragments allows Dynamo to adapt to changes in the application's branch biases. When a trace is re-created, Dynamo may select a different tail of instructions from the same start-of-trace point. This automatic "re-biasing" of fragments is another useful side effect of the pre-emptive cache flushing strategy.

---

### النسخة العربية

لا يستطيع دينامو تحمل إدارة معقدة لتخزين ذاكرة الأجزاء المؤقتة، بسبب التكاليف التي سيتكبدها ذلك. يمكننا تجنب إدارة التخزين تماماً بمجرد توسيع حجم ذاكرة الأجزاء المؤقتة حسب الحاجة. لكن هذا له عدة تأثيرات غير مرغوب فيها. على سبيل المثال، إحدى مزايا جمع الآثار الساخنة في ذاكرة أجزاء مؤقتة منفصلة هي تحسين موضعية ذاكرة التعليمات المؤقتة واستخدام TLB الذي يمكن أن ينتج عن الحفاظ على مجموعة العمل قريبة من بعضها في الذاكرة. قد تختفي هذه الميزة إذا انتشرت الآثار الساخنة التي تشكل مجموعة العمل الحالية بمرور الوقت على مساحة كبيرة من ذاكرة الأجزاء المؤقتة. من الواضح أن الحالة المثالية حيث تحتوي ذاكرة الأجزاء المؤقتة فقط على الآثار التي تشكل مجموعة العمل الحالية يصعب تحقيقها. ستكون تكلفة تطبيق مخطط من نوع LRU لتحديد الأجزاء الباردة باهظة أيضاً. علاوة على ذلك، كما أشير سابقاً، فإن أي سياسة تزيل فقط عدداً قليلاً من الأجزاء ستتكبد تكلفة الاضطرار إلى فك ربط كل تفريع وارد إلى هذه الأجزاء.

يستخدم دينامو بدلاً من ذلك استدلالي مسح استباقي مبتكر لإزالة الآثار الباردة دورياً من ذاكرة الأجزاء المؤقتة دون تكبد عقوبة عالية. يُشغَّل مسح كامل لذاكرة الأجزاء المؤقتة كلما تعرَّف دينامو على زيادة حادة في معدل إنشاء الأجزاء (أو معدل اختيار الأثر الساخن). المنطق هنا هو أن الارتفاع الحاد في إنشاء أجزاء جديدة من المرجح جداً أن يكون دليلاً على تغيير كبير في مجموعة عمل البرنامج الموجودة حالياً في ذاكرة الأجزاء المؤقتة. نظراً لأن التحكم يُقضى في الغالب في دينامو خلال هذه المرحلة، فإن مسح ذاكرة الأجزاء المؤقتة هو في الأساس "مجاني". يوضح الشكل 6 هذا السيناريو لمعيار m88ksim من SpecInt95. نظراً لأن جميع الأجزاء تُزال أثناء مسح ذاكرة الأجزاء المؤقتة، فلا حاجة لفك ربط التفريعات.

لآلية المسح الاستباقي آثار جانبية مفيدة أخرى. جميع بنى البيانات المتعلقة بالأجزاء المحفوظة للمحاسبة الداخلية بواسطة دينامو مرتبطة بالمسح، مما يتسبب في إعادة تعيين مجمعات الذاكرة هذه كأثر جانبي للمسح الاستباقي. وبالتالي يعمل المسح الاستباقي كآلية جمع نفايات فعالة لتحرير الكائنات الديناميكية المرتبطة بالأجزاء التي من المحتمل أن تكون قد خرجت من مجموعة العمل الحالية. إذا مُسحَت بعض الأجزاء التي تنتمي إلى مجموعة العمل الجديدة عن غير قصد نتيجة لذلك، فسيعيد دينامو توليدها عندما تُواجَه عناوين البرنامج تلك لاحقاً أثناء التنفيذ. يسمح إعادة توليد الأجزاء لدينامو بالتكيف مع التغييرات في تحيزات التفريعات للتطبيق. عندما يُعاد إنشاء أثر، قد يختار دينامو ذيلاً مختلفاً من التعليمات من نفس نقطة بداية الأثر. إعادة "التحيز" التلقائية هذه للأجزاء هي أثر جانبي مفيد آخر لاستراتيجية مسح الذاكرة المؤقتة الاستباقية.

---

### Translation Notes

- **Figures referenced:** Figure 6 (dynamic trace selection rate for m88ksim showing working set change)
- **Key concepts:** Pre-emptive flushing, working set changes, instruction cache locality, TLB utilization
- **Performance considerations:** "Free" flush when Dynamo is already dominant, no unlinking cost
- **Side effects:** Garbage collection, adaptive re-biasing of fragments
- **Benchmark:** SpecInt95 m88ksim showing sharp working set change at ~106 seconds

### Quality Metrics

- Semantic equivalence: 0.87
- Technical accuracy: 0.86
- Readability: 0.85
- Glossary consistency: 0.86
- **Overall section score:** 0.86
